name: CI

# Trigger CI on pushes and pull requests to main branch
on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main
  workflow_call:

# Define jobs
jobs:
  
  # Job 1: Check dependencies and installation
  check_dependencies:
    uses: access-nri/pyISSM/.github/workflows/check-dependencies.yml@main

  # Job 2: Build ISSM
  build_issm:
    uses: access-nri/pyISSM/.github/workflows/build-issm.yml@main

  # Job 3: Build ISSM AD
  build_issm_ad:
    uses: access-nri/pyISSM/.github/workflows/build-issm-ad.yml@main

  # Job 4: Run ISSM tests
  issm_tests:
    needs: build_issm
    uses: access-nri/pyISSM/.github/workflows/issm-tests.yml@main
    with:
      build-type: "issm"
      test-args: "--range 9999:9999"

  # Job 5: Run ISSM AD tests
  issm_ad_tests:
    needs: build_issm_ad
    uses: access-nri/pyISSM/.github/workflows/issm-tests.yml@main
    with:
      build-type: "issm-AD"
      test-args: "--range 3015:3481 --exclude 3001,3002,3003,3004,3005,3006,3007,3008,3009,3010,3010,3019,3020,3101,3102,3103,3104,3105,3106,3107,3108,3109,3110,3111,3112,3113,3114,3115,3116,3117,3118" 